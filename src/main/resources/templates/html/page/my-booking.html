<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chi Tiết Đơn Hàng Vé Phim</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <style>
    :root {
      --primary-color: #9a2ee5;
      --secondary-color: #5200ff;
    }
    body {
      font-family: 'Arial', sans-serif;
    }
    .movie-card {
      border-radius: 15px;
      overflow: hidden;
      transition: all 0.3s ease;
      box-shadow: 0 10px 25px rgba(0,0,0,0.1);
    }
    .movie-card:hover {
      transform: translateY(-10px);
      box-shadow: 0 15px 35px rgba(0,0,0,0.15);
    }
    .movie-card-header {
      background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
      color: white;
    }
    .order-summary-item {
      display: flex;
      justify-content: space-between;
      margin-bottom: 10px;
      padding: 10px;
      background-color: #f8f9fa;
      border-radius: 8px;
    }
    .coupon-badge {
      background: linear-gradient(45deg, #ff9966, #ff5e62);
      color: white;
    }
    .seats-list {
      background-color: #f0f0f0;
      border-radius: 8px;
      padding: 10px;
      display: flex;
      flex-wrap: wrap;
      gap: 5px;
    }
    .seat-tag {
      background-color: var(--primary-color);
      color: white;
      padding: 3px 8px;
      border-radius: 4px;
      font-size: 0.9em;
    }
    .date-header {
      text-align: center;
      margin-bottom: 20px;
      position: relative;
      overflow: hidden;
    }
    .date-header h4 {
      display: inline-block;
      background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
      color: white;
      padding: 10px 20px;
      border-radius: 25px;
      font-weight: 500;
      position: relative;
      z-index: 1;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    .date-header::before,
    .date-header::after {
      content: '';
      position: absolute;
      top: 50%;
      width: 45%;
      height: 1px;
      background: linear-gradient(to right, transparent, var(--primary-color), transparent);
    }
    .date-header::before {
      left: 0;
    }
    .date-header::after {
      right: 0;
    }
  </style>
</head>
<body>
<!-- Navbar -->
<nav class="navbar navbar-expand-lg fixed-top bg-white shadow-sm">
  <div class="container">
    <a class="navbar-brand" href="#">
      <img src="/assets/img/logo2.png" alt="MoMo" width="85" height="40">
    </a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
            aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav ms-auto">
        <li class="nav-item">
          <a class="nav-link" href="#">Đặt vé xem phim</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#">Lịch chiếu</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#">Rạp chiếu</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#">Review phim</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#">Top phim</a>
        </li>
      </ul>
    </div>
  </div>
</nav>

<div class="container py-5 mt-5">
  <div id="orderCardContainer" class="row g-4">
    <!-- Các card đơn hàng sẽ được render ở đây -->
  </div>
</div>

<!-- Modal Chi Tiết Đơn Hàng -->
<div class="modal fade" id="orderDetailModal" tabindex="-1">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header movie-card-header">
        <h5 class="modal-title" id="modalOrderId">Chi Tiết Đơn Hàng</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body" id="modalOrderDetails">
        <!-- Nội dung chi tiết sẽ được chèn động -->
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
  $(document).ready(function() {
    const orderData = [
      {
        id: 'MV001',
        movie: 'Avengers: Endgame',
        date: '26/03/2024',
        time: '20:00',
        theater: 'CGV Vincom Đống Đa',
        room: 'Phòng Chiếu Số 3',
        address: 'Tầng 5, TTTM Vincom, 191 Bà Triệu, Hai Bà Trưng, Hà Nội',
        tickets: 2,
        total: 200000,
        status: 'Thành Công',
        poster: 'https://via.placeholder.com/150x225?text=Avengers',
        seats: ['A3', 'A4'],
        foods: [
          { name: 'Bắp Rang Bơ Lớn', price: 45000, quantity: 1 },
          { name: 'Coca-Cola', price: 35000, quantity: 2 }
        ],
        coupon: {
          code: 'MOVIE20',
          discount: 20000
        }
      },
      // Thêm các đơn hàng khác với các ngày khác nhau
      {
        id: 'MV002',
        movie: 'Spider-Man: No Way Home',
        date: '26/03/2024',
        time: '22:00',
        theater: 'Galaxy Cinema',
        room: 'Phòng Chiếu Số 5',
        address: 'Tầng 6, TTTM Vincom, 191 Bà Triệu, Hai Bà Trưng, Hà Nội',
        tickets: 1,
        total: 100000,
        status: 'Thành Công',
        poster: 'https://via.placeholder.com/150x225?text=SpiderMan',
        seats: ['B2'],
        foods: [
          { name: 'Bắp Rang Bơ Nhỏ', price: 35000, quantity: 1 }
        ],
        coupon: null
      },
      {
        id: 'MV003',
        movie: 'Black Widow',
        date: '27/03/2024',
        time: '19:30',
        theater: 'BHD Star Cineplex',
        room: 'Phòng Chiếu Số 2',
        address: 'Tầng 4, TTTM Vincom, 191 Bà Triệu, Hai Bà Trưng, Hà Nội',
        tickets: 3,
        total: 300000,
        status: 'Thành Công',
        poster: 'https://via.placeholder.com/150x225?text=BlackWidow',
        seats: ['C1', 'C2', 'C3'],
        foods: [
          { name: 'Bắp Rang Bơ Lớn', price: 45000, quantity: 2 },
          { name: 'Pepsi', price: 35000, quantity: 3 }
        ],
        coupon: {
          code: 'CINEMA10',
          discount: 10000
        }
      }
    ];

    function groupOrdersByDate(orders) {
      // Sắp xếp đơn hàng theo ngày giảm dần
      const sortedOrders = orders.sort((a, b) => {
        const [dayA, monthA, yearA] = a.date.split('/').map(Number);
        const [dayB, monthB, yearB] = b.date.split('/').map(Number);
        const dateA = new Date(yearA, monthA - 1, dayA);
        const dateB = new Date(yearB, monthB - 1, dayB);
        return dateB - dateA;
      });

      // Nhóm đơn hàng theo ngày
      const groupedOrders = sortedOrders.reduce((groups, order) => {
        if (!groups[order.date]) {
          groups[order.date] = [];
        }
        groups[order.date].push(order);
        return groups;
      }, {});

      return groupedOrders;
    }

    function renderGroupedOrderCards(groupedOrders) {
      const $container = $('#orderCardContainer');
      $container.empty();

      const statusClasses = {
        'Thành Công': 'bg-success text-white',
        'Chờ Thanh Toán': 'bg-warning text-dark',
        'Đã Hủy': 'bg-danger text-white'
      };

      // Duyệt qua các nhóm ngày
      Object.keys(groupedOrders).forEach(date => {
        // Thêm tiêu đề ngày với style mới
        $container.append(`
            <div class="col-12 date-header">
                <h4>${date}</h4>
            </div>
        `);

        // Render các đơn hàng trong ngày
        groupedOrders[date].forEach(order => {
          const $card = $(`
                <div class="col-md-4">
                    <div class="card movie-card">
                        <div class="movie-card-header p-3 d-flex justify-content-between align-items-center">
                            <span class="badge ${statusClasses[order.status]} status-badge">
                                ${order.status}
                            </span>
                            <small>Mã đơn: ${order.id}</small>
                        </div>
                        <div class="card-body p-3">
                            <div class="d-flex">
                                <img src="${order.poster}" class="rounded shadow" style="width: 100px; height: 150px; object-fit: cover;">
                                <div class="ms-3 flex-grow-1">
                                    <h5 class="card-title mb-2">${order.movie}</h5>
                                    <p class="card-text mb-1">
                                        <i class="bi bi-calendar me-2"></i>${order.date} - ${order.time}
                                    </p>
                                    <p class="card-text mb-1">
                                        <i class="bi bi-geo-alt me-2"></i>${order.theater}
                                    </p>
                                    <div class="d-flex justify-content-between align-items-center mt-2">
                                        <div>
                                            <span class="badge bg-info me-2">
                                                ${order.tickets} Vé
                                            </span>
                                            <strong>${order.total.toLocaleString()} VND</strong>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="card-footer bg-transparent d-flex justify-content-between">
                            <button class="btn btn-outline-primary view-order" data-id="${order.id}">
                                <i class="bi bi-eye me-1"></i>Chi Tiết
                            </button>
                            <button class="btn btn-outline-success download-ticket" data-id="${order.id}">
                                <i class="bi bi-download me-1"></i>Tải Vé
                            </button>
                        </div>
                    </div>
                </div>
            `);

          $container.append($card);
        });
      });
    }

    function renderOrderDetails(order) {
      const $modalDetails = $('#modalOrderDetails');
      $modalDetails.empty();

      // Tính toán tổng tiền
      const foodTotal = order.foods.reduce((total, food) => total + (food.price * food.quantity), 0);
      const subtotal = order.total;
      const totalWithFood = subtotal + foodTotal;
      const finalTotal = totalWithFood - (order.coupon ? order.coupon.discount : 0);

      const $details = $(`
        <div class="row">
            <div class="col-md-6">
                <div class="mb-3">
                    <h5>Thông Tin Phim</h5>
                    <p class="mb-1"><strong>Tên Phim:</strong> ${order.movie}</p>
                    <p class="mb-1"><strong>Rạp:</strong> ${order.theater}</p>
                    <p class="mb-1"><strong>Phòng Chiếu:</strong> ${order.room}</p>
                    <p class="mb-3"><strong>Địa Chỉ:</strong> ${order.address}</p>

                    <h5>Ghế Đã Đặt</h5>
                    <div class="seats-list">
                        ${order.seats.map(seat => `<span class="seat-tag">${seat}</span>`).join('')}
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <h5 class="mb-3">Chi Tiết Đơn Hàng</h5>
                <div class="order-summary-item">
                    <span>Vé Phim</span>
                    <strong>${subtotal.toLocaleString()} VND</strong>
                </div>
                <div class="order-summary-item">
                    <span>Đồ Ăn & Thức Uống</span>
                    <strong>${foodTotal.toLocaleString()} VND</strong>
                </div>
                ${order.coupon ? `
                <div class="order-summary-item">
                    <span>
                        Mã Giảm Giá
                        <span class="badge coupon-badge ms-2">${order.coupon.code}</span>
                    </span>
                    <strong>-${order.coupon.discount.toLocaleString()} VND</strong>
                </div>
                ` : ''}
                <div class="order-summary-item bg-light fw-bold">
                    <span>Tổng Cộng</span>
                    <strong>${finalTotal.toLocaleString()} VND</strong>
                </div>

                <h5 class="mt-4 mb-3">Đồ Ăn & Thức Uống</h5>
                ${order.foods.map(food => `
                    <div class="order-summary-item">
                        <span>${food.name}</span>
                        <span>
                            x${food.quantity}
                            <strong class="ms-2">${(food.price * food.quantity).toLocaleString()} VND</strong>
                        </span>
                    </div>
                `).join('')}
            </div>
        </div>
    `);

      $modalDetails.append($details);
    }

    // Render ban đầu
    const groupedOrders = groupOrdersByDate(orderData);
    renderGroupedOrderCards(groupedOrders);

    // Giữ nguyên logic xem chi tiết đơn hàng
    $(document).on('click', '.view-order', function() {
      const orderId = $(this).data('id');
      const order = orderData.find(o => o.id === orderId);

      $('#modalOrderId').text(`Chi Tiết Đơn Hàng ${orderId}`);
      renderOrderDetails(order);

      new bootstrap.Modal(document.getElementById('orderDetailModal')).show();
    });
  });
</script>
</body>
</html>